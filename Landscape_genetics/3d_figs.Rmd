---
title: "3D figures"
author: "D. G. Gannon"
date: "January 2021"
output:
  github_document:
    pandoc_args: --webtex
bibliography: /Users/dusty/Documents/zotero_library.bib
---


```{r setup, include=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo = TRUE)

  require(rstan)
  require(CholWishart)
  require(tidyverse)
  require(here)
  require(ggridges)
  require(raster)

# functions
 #compute distance matrix among observations in matrix m
  dist_matrix <- function(m){
    n <- nrow(m)
    ones <- rep(1,n)
    Gmat <- m%*%t(m) 
    diag_G <- diag(Gmat)
    return(ones%*%t(diag_G) -2*Gmat + diag_G%*%t(ones))
  }
  
# create symmetric matrix that is average of x[i] and x[j]
  sym_matrix <- function(x){
    N <- length(x)
    M <- matrix(data = 0, nrow = N, ncol = N)
    for(i in 1:N){
      for(j in i:N){
        M[i,j] <- (x[i] + x[j])/2
      }
    }
     M_prime <- t(M)
     M_prime <- `diag<-`(M_prime,0)
     return(M + M_prime)
  }
  
# construct the weights matrix given array X,
#  vector beta, matrix Z, and vector alpha
  
  make_W <- function(size, X, beta, Z, alpha){
    W_upper <- matrix(data=0, nrow = size, ncol = size)
    for(i in 1:size){
      for(j in i:size){
        W_upper[i,j] <- exp(X[i,j,]%*%beta + Z[i,]%*%alpha)
      }
    }
    W_upper <- `diag<-`(W_upper, 0)
    return(W_upper + t(W_upper))
  }
  
```




```{r}

  N_new <- 20
  X_new <- array(data=1, dim = c(N_new, N_new, 9))

```

### List of covariates

* Intercept

* geographic distance between plants $i$ and $j$ (Km)

* mean plant density within five meters around $i$ and $j$

* mean canopy cover above $i$ and $j$

* mean proportion of forest within a 500m buffer around $i$ and $j$

* Square of mean proportion of forest within a 500m buffer

* distance $\times$ canopy cover interaction

* $\mathbb{I}$($i$ and $j$ from the same meadow)

* $mathbb{I}$($i$ and $j$ from the same meadow complex)


```{r}

N_new <- 10
newdat <- data.frame(
  x=rep(0,(N_new*N_new)),
  y=rep(seq(0, 8, length.out = N_new), each=N_new),
  iso = rep(seq(0.4,1, length.out = N_new), N_new)
)
```

```{r}
  X_new[,,1] <- matrix(data = 1, nrow = N_new, ncol = N_new)

 # distance
  X_new[,,2] <- sqrt(
    dist_matrix(
      cbind(newdat$x, newdat$y)
    )
  )
```







